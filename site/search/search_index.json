{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Home","text":"Welcome to the pibiCo Documentation Portal  <p>This is the central documentation portal for our OSS projects.</p> <ul> <li>Projects</li> <li>About Us</li> </ul>"},{"location":"about/","title":"About pibiCo","text":"<p>Our Expert Team</p> <p>First and foremost, we are industrial and mining engineers with over 25 years of professional experience. Experts in Business and Project Management. We bring you closer to the Digital Enterprise</p> <ul> <li>GitHub: https://github.com/pibico</li> <li>LinkedIn: https://www.linkedin.com/company/pibico</li> <li>YouTube: @pibicosl9496</li> <li>Contact: proyectos@pibico.es</li> </ul>"},{"location":"projects/pibical/","title":"PibiCal","text":"<p>Welcome to the PibiCal documentation.</p>"},{"location":"projects/pibical/#contents","title":"Contents","text":"<ul> <li>Project Guide</li> </ul>"},{"location":"projects/pibical/guide/","title":"PibiCal","text":"<p>Bidirectional Calendar Synchronization for Frappe/ERPNext and CalDAV Servers</p> <p> </p> <p>PibiCal enables seamless, real-time synchronization of calendar events between your Frappe/ERPNext instance and CalDAV-compatible servers (NextCloud, ownCloud, etc.). It supports bidirectional sync, recurring events, timezone management, and more.</p>"},{"location":"projects/pibical/guide/#table-of-contents","title":"\ud83d\udccb Table of Contents","text":"<ul> <li>Features</li> <li>Version Compatibility</li> <li>Requirements</li> <li>Installation</li> <li>Configuration</li> <li>Usage</li> <li>Architecture</li> <li>Code Structure</li> <li>API Reference</li> <li>Performance</li> <li>Troubleshooting</li> <li>Development</li> <li>Recent Updates</li> <li>Contributing</li> <li>License</li> </ul>"},{"location":"projects/pibical/guide/#features","title":"\u2728 Features","text":""},{"location":"projects/pibical/guide/#core-capabilities","title":"Core Capabilities","text":"<ul> <li>\u2705 Bidirectional Sync - Changes in Frappe/ERPNext \u2194\ufe0f CalDAV servers sync automatically</li> <li>\u2705 Timezone Support - Events properly converted between user timezones and UTC</li> <li>\u2705 Recurring Events - Weekly, monthly, yearly patterns with end dates</li> <li>\u2705 Event Status - Open, Completed, Cancelled states synchronized</li> <li>\u2705 All-Day Events - Properly handled as date-only events</li> <li>\u2705 Multiple Calendars - Support for multiple CalDAV calendars per user</li> <li>\u2705 Event Invitations - Send calendar invitations with .ics attachments</li> </ul>"},{"location":"projects/pibical/guide/#synchronization-details","title":"Synchronization Details","text":"Feature Frappe \u2192 CalDAV CalDAV \u2192 Frappe Speed Instant Every 3 minutes Event Creation \u2705 Supported \u2705 Supported Event Updates \u2705 Supported \u2705 Supported Event Deletion \u2705 Supported \u26a0\ufe0f Manual only Recurring Events \u2705 Supported \u2705 Supported Timezone Handling \u2705 Automatic \u2705 Automatic"},{"location":"projects/pibical/guide/#limitations","title":"Limitations","text":"<ul> <li>\u274c Private Events: Only \"Public\" events are synchronized</li> <li>\u274c Attachments: File attachments are not synced</li> <li>\u26a0\ufe0f Deletion Sync: CalDAV \u2192 Frappe deletions require manual cleanup</li> <li>\u26a0\ufe0f Participants: Frappe \u2192 CalDAV only (disabled by default)</li> </ul>"},{"location":"projects/pibical/guide/#version-compatibility","title":"\ud83d\udce6 Version Compatibility","text":"Frappe Version PibiCal Branch Status Notes v15 <code>develop</code> \u2705 Active Development Recommended for new installations v13 <code>version-13</code> \u2705 Stable Production ready v12 <code>version-12</code> \u26a0\ufe0f Legacy No longer maintained <p>Current Version: 2.0 (December 2025)</p>"},{"location":"projects/pibical/guide/#requirements","title":"\ud83d\udd27 Requirements","text":""},{"location":"projects/pibical/guide/#system-requirements","title":"System Requirements","text":"<ul> <li>Frappe/ERPNext: v15 (for this branch) or v13 (version-13 branch)</li> <li>CalDAV Server: NextCloud, ownCloud, or any CalDAV-compatible server</li> <li>SSL/TLS: Must be enabled (wildcard certificates NOT supported)</li> <li>Python: 3.10+ (included with Frappe)</li> </ul>"},{"location":"projects/pibical/guide/#python-dependencies","title":"Python Dependencies","text":"<pre><code>frappe &gt;= 15.0.0\ncaldav &gt;= 0.9.0\nicalendar &gt;= 4.0.0\n</code></pre> <p>These are automatically installed via <code>requirements.txt</code>.</p>"},{"location":"projects/pibical/guide/#server-requirements","title":"Server Requirements","text":"<ul> <li>CalDAV Endpoint: Valid CalDAV server URL</li> <li>Authentication: Username and password/app-specific token</li> <li>Permissions: Read/write access to calendars</li> <li>Network: Stable connection between Frappe and CalDAV server</li> </ul>"},{"location":"projects/pibical/guide/#installation","title":"\ud83d\ude80 Installation","text":""},{"location":"projects/pibical/guide/#standard-installation","title":"Standard Installation","text":"<pre><code># Navigate to your frappe-bench directory\ncd ~/frappe-bench\n\n# Download the app (Frappe v15)\nbench get-app pibical https://github.com/pibico/pibical.git --branch develop\n\n# Install on your site\nbench --site your-site-name install-app pibical\n\n# Restart bench to apply changes\nbench restart\n</code></pre>"},{"location":"projects/pibical/guide/#for-frappe-v13","title":"For Frappe v13","text":"<pre><code>bench get-app pibical https://github.com/pibico/pibical.git --branch version-13\nbench --site your-site-name install-app pibical\nbench restart\n</code></pre>"},{"location":"projects/pibical/guide/#updating","title":"Updating","text":"<pre><code># Update the app\ncd ~/frappe-bench\nbench update --apps pibical --no-backup\n\n# If you encounter dependency issues\nbench update --requirements\n\n# Restart\nbench restart\n</code></pre>"},{"location":"projects/pibical/guide/#uninstalling","title":"Uninstalling","text":"<pre><code>bench --site your-site-name uninstall-app pibical\nbench remove-app pibical\n</code></pre>"},{"location":"projects/pibical/guide/#configuration","title":"\u2699\ufe0f Configuration","text":""},{"location":"projects/pibical/guide/#step-1-configure-caldav-credentials","title":"Step 1: Configure CalDAV Credentials","text":"<p>Each user must configure their CalDAV credentials:</p> <ol> <li>Navigate: User List \u2192 Select User \u2192 Edit</li> <li>Scroll to: CalDAV Credentials section</li> <li>Fill in:</li> </ol> Field Description Example CalDAV URL CalDAV server endpoint <code>https://cloud.example.com/remote.php/dav/principals/</code> CalDAV Username Your CalDAV username <code>john.doe</code> or <code>john.doe@example.com</code> CalDAV Token Password or app-specific token <code>your-secure-token</code> <p>NextCloud Tip: Generate app-specific passwords from Settings \u2192 Security \u2192 Devices &amp; Sessions</p>"},{"location":"projects/pibical/guide/#step-2-enable-sync-for-events","title":"Step 2: Enable Sync for Events","text":"<p>When creating or editing events:</p> <ol> <li>Set Event Type = \"Public\" (required)</li> <li>Check \u2705 \"Sync with CalDAV\"</li> <li>Select your calendar from \"CalDAV ID Calendar\" dropdown</li> <li>Fill in event details (subject, date, time, etc.)</li> <li>Save - Event syncs immediately to CalDAV</li> </ol>"},{"location":"projects/pibical/guide/#step-3-verify-sync-is-running","title":"Step 3: Verify Sync is Running","text":"<pre><code># Check scheduler status\ncd ~/frappe-bench\nbench --site your-site-name doctor\n\n# Should show:\n# \u2713 Scheduler Active: Yes\n</code></pre>"},{"location":"projects/pibical/guide/#configuration-options","title":"Configuration Options","text":""},{"location":"projects/pibical/guide/#sync-frequency","title":"Sync Frequency","text":"<p>Default: Every 3 minutes</p> <p>To Change: Edit <code>pibical/hooks.py</code></p> <pre><code>scheduler_events = {\n  \"cron\": {\n    \"*/3 * * * *\": [  # Modify this cron expression\n      \"pibical.pibical.custom.sync_outside_caldav\"\n    ]\n  }\n}\n</code></pre> <p>Options: - <code>*/1 * * * *</code> - Every 1 minute (high load) - <code>*/5 * * * *</code> - Every 5 minutes (balanced) - <code>*/10 * * * *</code> - Every 10 minutes (low load)</p> <p>After changing: <code>bench restart</code></p>"},{"location":"projects/pibical/guide/#date-range-for-sync","title":"Date Range for Sync","text":"<p>Default: Yesterday to +30 days</p> <p>To Change: Edit <code>pibical/pibical/custom.py</code> (line ~627)</p> <pre><code>sel_events = c.date_search(\n    datetime.now().date() - timedelta(days=1),   # Start\n    datetime.now().date() + timedelta(days=30)   # End\n)\n</code></pre> <p>Recommendations: - Small calendars (&lt;100 events): -7 to +60 days - Medium calendars (100-500 events): -1 to +30 days (default) - Large calendars (&gt;500 events): 0 to +14 days</p>"},{"location":"projects/pibical/guide/#usage","title":"\ud83d\udcd6 Usage","text":""},{"location":"projects/pibical/guide/#creating-a-synchronized-event","title":"Creating a Synchronized Event","text":"<p>In Frappe UI:</p> <ol> <li>Navigate to Event \u2192 New Event</li> <li>Fill in:</li> <li>Subject: \"Team Meeting\"</li> <li>Event Type: \"Public\" (required)</li> <li>Sync with CalDAV: \u2705 Checked</li> <li>CalDAV ID Calendar: Select your calendar</li> <li>Starts On / Ends On: Set date/time</li> <li>Description: Optional</li> <li>Save</li> </ol> <p>Expected: Message \"Event created on CalDAV server\" Result: Event appears in NextCloud within 30 seconds</p>"},{"location":"projects/pibical/guide/#synchronization-behavior","title":"Synchronization Behavior","text":""},{"location":"projects/pibical/guide/#event-created-in-frappeerpnext","title":"\ud83d\udcc5 Event Created in Frappe/ERPNext","text":"<p>Actions: - UID Generated: <code>frappe[hash]@pibico.es</code> - Immediate sync to CalDAV - Fields set: <code>event_uid</code>, <code>caldav_id_url</code>, <code>event_stamp</code></p> <p>Message: \"Event created on CalDAV server\"</p>"},{"location":"projects/pibical/guide/#event-created-in-nextcloudcaldav","title":"\ud83d\udcc5 Event Created in NextCloud/CalDAV","text":"<p>Actions: - Background sync detects new event (every 3 minutes) - UID preserved from CalDAV (no \"frappe\" prefix) - Event Type set to \"Public\" in Frappe - Timezone converted to user's local time</p> <p>Result: Event appears in Frappe within 3 minutes (silent sync)</p>"},{"location":"projects/pibical/guide/#event-modified-in-frappeerpnext","title":"\u270f\ufe0f Event Modified in Frappe/ERPNext","text":"<p>Actions: - If calendar changed: Deletes from old, creates in new - Uses smart update mechanism (no_create=True) - Original UID maintained</p> <p>Message: \"Event updated on CalDAV server\"</p>"},{"location":"projects/pibical/guide/#event-modified-in-nextcloudcaldav","title":"\u270f\ufe0f Event Modified in NextCloud/CalDAV","text":"<p>Actions: - Timestamp comparison (\u00b11 second tolerance) - Updates: subject, times, description, status, recurrence - Frappe-specific fields preserved</p> <p>Result: Event updated in Frappe within 3 minutes (silent sync)</p>"},{"location":"projects/pibical/guide/#event-deleted-in-frappeerpnext","title":"\ud83d\uddd1\ufe0f Event Deleted in Frappe/ERPNext","text":"<p>Actions: - Immediate deletion from CalDAV - Three methods attempted (URL, UID search, date scan)</p> <p>Messages: - \u2705 \"Deleted Event in CalDav Calendar [name]\" - \u26a0\ufe0f \"Event not found in CalDAV calendar\"</p>"},{"location":"projects/pibical/guide/#event-deleted-in-nextcloudcaldav","title":"\ud83d\uddd1\ufe0f Event Deleted in NextCloud/CalDAV","text":"<p>Current Limitation: \u26a0\ufe0f Not automatically synced to Frappe Workaround: Manually delete event in Frappe</p>"},{"location":"projects/pibical/guide/#sending-event-invitations","title":"Sending Event Invitations","text":"<ol> <li>Open event in Frappe</li> <li>Add participants (Contacts with email addresses)</li> <li>Save event</li> <li>Click \"Send Invitations\" button</li> <li>Select recipients</li> <li>Click Send</li> </ol> <p>Recipients receive email with .ics attachment they can import to their calendar.</p>"},{"location":"projects/pibical/guide/#architecture","title":"\ud83c\udfd7\ufe0f Architecture","text":""},{"location":"projects/pibical/guide/#system-overview","title":"System Overview","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                  BIDIRECTIONAL SYNC                     \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502  ERPNext/Frappe \u2190\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2192 CalDAV Server      \u2502\n\u2502                                                         \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u2502\n\u2502  \u2502 Event.save() \u2502              \u2502  CalDAV Server   \u2502     \u2502\n\u2502  \u2502              \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2192\u2502  (NextCloud)     \u2502     \u2502\n\u2502  \u2502 before_save  \u2502   Instant    \u2502                  \u2502     \u2502\n\u2502  \u2502 hook         \u2502              \u2502  PUT/POST event  \u2502     \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518              \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2502\n\u2502         \u2191                               \u2193               \u2502\n\u2502         \u2502                               \u2502               \u2502\n\u2502         \u2502 Flag: ignore_sync             \u2502               \u2502\n\u2502         \u2502                               \u2502               \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u2502\n\u2502  \u2502 Background   \u2502              \u2502  CalDAV Server   \u2502     \u2502\n\u2502  \u2502 Job          \u2502\u2190\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502                  \u2502     \u2502\n\u2502  \u2502 (every 3min) \u2502  Poll events \u2502  GET events      \u2502     \u2502\n\u2502  \u2502              \u2502              \u2502  (date range)    \u2502     \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518              \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"projects/pibical/guide/#sync-flow-erpnext-caldav","title":"Sync Flow (ERPNext \u2192 CalDAV)","text":"<ol> <li>User saves Event in Frappe UI</li> <li><code>before_save</code> hook triggers <code>sync_caldav_event_by_user()</code></li> <li>Check flag: If <code>ignore_caldav_sync</code> set, skip (prevents loops)</li> <li>Validate: CalDAV credentials exist</li> <li>Build iCalendar: Convert Frappe Event \u2192 iCal format</li> <li>Sync:</li> <li>New event: <code>c.save_event(ical_data)</code></li> <li>Update: <code>c.save_event(ical_data, no_create=True)</code></li> <li>Success: Show message to user</li> </ol>"},{"location":"projects/pibical/guide/#sync-flow-caldav-erpnext","title":"Sync Flow (CalDAV \u2192 ERPNext)","text":"<ol> <li>Cron job runs <code>sync_outside_caldav()</code> every 3 minutes</li> <li>Get users with CalDAV credentials</li> <li>For each user:</li> <li>Connect to CalDAV server</li> <li>For each calendar:<ul> <li>Fetch events (yesterday to +30 days)</li> <li>For each event:</li> <li>Check if already processed (dedupe)</li> <li>Check if exists in Frappe by UID</li> <li>If exists: Compare timestamps, update if modified</li> <li>If new: Create in Frappe</li> <li>Set flag: <code>ignore_caldav_sync = True</code> (prevents loop)</li> </ul> </li> <li>Commit: Save all changes</li> </ol>"},{"location":"projects/pibical/guide/#loop-prevention-mechanism","title":"Loop Prevention Mechanism","text":"<p>Problem: Sync from CalDAV would trigger <code>before_save</code> hook, syncing back to CalDAV (infinite loop)</p> <p>Solution: Document flags</p> <pre><code># When syncing FROM CalDAV:\nevent.flags.ignore_caldav_sync = True\nevent.save()  # Hook checks this flag and skips\n\n# In sync hook:\nif doc.flags.get('ignore_caldav_sync'):\n    return  # Skip sync back to CalDAV\n</code></pre> <p>Flags are: - In-memory only (not persisted to DB) - Temporary (cleared after save) - Frappe-native functionality</p>"},{"location":"projects/pibical/guide/#code-structure","title":"\ud83d\udcc2 Code Structure","text":""},{"location":"projects/pibical/guide/#directory-layout","title":"Directory Layout","text":"<pre><code>pibical/\n\u251c\u2500\u2500 pibical/\n\u2502   \u251c\u2500\u2500 __init__.py\n\u2502   \u251c\u2500\u2500 hooks.py                 # Frappe integration hooks\n\u2502   \u2514\u2500\u2500 pibical/\n\u2502       \u251c\u2500\u2500 __init__.py\n\u2502       \u251c\u2500\u2500 custom.py            # Main sync logic (800+ lines)\n\u2502       \u251c\u2500\u2500 doctype/             # Custom doctypes (if any)\n\u2502       \u2514\u2500\u2500 fixtures/            # Database customizations\n\u2502           \u251c\u2500\u2500 custom_field.json      # Custom fields for User &amp; Event\n\u2502           \u251c\u2500\u2500 client_script.json     # Client-side JavaScript\n\u2502           \u2514\u2500\u2500 server_script.json     # Server-side scripts\n\u251c\u2500\u2500 requirements.txt             # Python dependencies\n\u251c\u2500\u2500 setup.py                     # Package setup\n\u251c\u2500\u2500 license.txt                  # MIT License\n\u251c\u2500\u2500 README.md                    # This file\n\u2514\u2500\u2500 CLAUDE.md                    # AI assistant context\n</code></pre>"},{"location":"projects/pibical/guide/#key-files","title":"Key Files","text":""},{"location":"projects/pibical/guide/#pibicalhookspy","title":"<code>pibical/hooks.py</code>","text":"<p>Purpose: Integrates PibiCal with Frappe framework</p> <p>Key Definitions:</p> <pre><code># Document event hooks\ndoc_events = {\n  \"Event\": {\n    \"before_save\": \"pibical.pibical.custom.sync_caldav_event_by_user\",\n    \"on_trash\": \"pibical.pibical.custom.remove_caldav_event\"\n  }\n}\n\n# Scheduled tasks\nscheduler_events = {\n  \"cron\": {\n    \"*/3 * * * *\": [\n      \"pibical.pibical.custom.sync_outside_caldav\"\n    ]\n  }\n}\n\n# Fixtures (custom fields)\nfixtures = [\n  {\"dt\": \"Custom Field\", \"filters\": {\"module\": [\"like\", \"PibiCal\"]}},\n  {\"dt\": \"Client Script\", \"filters\": {\"module\": [\"like\", \"PibiCal\"]}},\n  {\"dt\": \"Server Script\", \"filters\": {\"module\": [\"like\", \"PibiCal\"]}}\n]\n</code></pre>"},{"location":"projects/pibical/guide/#pibicalpibicalcustompy","title":"<code>pibical/pibical/custom.py</code>","text":"<p>Purpose: Core synchronization logic</p> <p>Key Functions (800+ lines total):</p> <ol> <li>Utility Functions:</li> <li><code>get_user_timezone()</code> - Get timezone from User settings</li> <li><code>is_event_modified()</code> - Compare timestamps (\u00b11s tolerance)</li> <li><code>convert_to_utc()</code> - Convert datetime to UTC</li> <li><code>convert_from_utc()</code> - Convert UTC to user timezone</li> <li> <p><code>generate_ics_for_event()</code> - Create .ics file for invitations</p> </li> <li> <p>Whitelisted API Methods (callable from client):</p> </li> <li><code>@frappe.whitelist() get_calendar(nuser)</code> - Retrieve user's calendars</li> <li><code>@frappe.whitelist() sync_caldav_event_by_user(doc, method)</code> - Sync event to CalDAV</li> <li><code>@frappe.whitelist() remove_caldav_event(doc, method)</code> - Delete from CalDAV</li> <li> <p><code>@frappe.whitelist() send_event_invitations(event_name, recipients)</code> - Email .ics</p> </li> <li> <p>Background Jobs:</p> </li> <li> <p><code>sync_outside_caldav()</code> - Main sync from CalDAV to Frappe</p> </li> <li> <p>Helper Functions:</p> </li> <li><code>prepare_fp_event(event, cal_event, user_tz)</code> - Convert CalDAV event to Frappe format</li> </ol> <p>Code Flow (<code>sync_caldav_event_by_user</code>):</p> <pre><code>def sync_caldav_event_by_user(doc, method=None):\n    # 1. Check loop prevention flag\n    if doc.flags.get('ignore_caldav_sync'):\n        return\n\n    # 2. Validate sync is enabled\n    if not doc.sync_with_caldav:\n        return\n\n    # 3. Get user CalDAV credentials\n    fp_user = frappe.get_doc(\"User\", frappe.session.user)\n\n    # 4. Handle calendar changes (delete from old)\n    if doc.caldav_id_url and calendar_changed:\n        remove_caldav_event(doc)\n\n    # 5. Generate/preserve UID\n    if not doc.event_uid:\n        doc.event_uid = generate_uid()\n\n    # 6. Build iCalendar object\n    cal = build_icalendar(doc, user_tz)\n\n    # 7. Sync to CalDAV\n    if is_new_event:\n        c.save_event(cal.to_ical())\n    else:\n        try:\n            c.save_event(cal.to_ical(), no_create=True)  # Smart update\n        except ConsistencyError:\n            c.save_event(cal.to_ical())  # Fallback: create\n\n    # 8. Show success message\n    frappe.msgprint(_(\"Event created/updated on CalDAV server\"))\n</code></pre> <p>Code Flow (<code>sync_outside_caldav</code>):</p> <pre><code>def sync_outside_caldav():\n    # 1. Get users with CalDAV credentials\n    users = frappe.get_list(\"User\", filters=[...])\n\n    # 2. Track processed UIDs (prevent duplicates)\n    sel_uuid = []\n\n    # 3. For each user\n    for user in users:\n        # 3a. Connect to CalDAV\n        client = caldav.DAVClient(url, username, password)\n        calendars = client.principal().calendars()\n\n        # 3b. For each calendar\n        for calendar in calendars:\n            # 3c. Fetch events (yesterday to +30 days)\n            events = calendar.date_search(start, end)\n\n            # 3d. For each event\n            for event in events:\n                # Parse iCalendar data\n                cal_data = event.data\n                evento = parse_ical(cal_data)\n\n                # Extract UID\n                uid = evento.decoded('uid')\n\n                # Skip if already processed\n                if uid in sel_uuid:\n                    continue\n                sel_uuid.append(uid)\n\n                # Check if exists in Frappe\n                fp_event = frappe.get_list(\"Event\", filters=[['event_uid', '=', uid]])\n\n                if fp_event:\n                    # Event exists - check if modified\n                    if is_event_modified(fp_event.event_stamp, caldav_stamp):\n                        # Update event\n                        event_doc = frappe.get_doc(\"Event\", fp_event.name)\n                        update_event(event_doc, evento, user_tz)\n                        event_doc.flags.ignore_caldav_sync = True  # KEY!\n                        event_doc.save()\n                else:\n                    # New event - create it\n                    new_event = frappe.new_doc(\"Event\")\n                    prepare_event(new_event, evento, user_tz)\n                    new_event.flags.ignore_caldav_sync = True  # KEY!\n                    new_event.save()\n</code></pre>"},{"location":"projects/pibical/guide/#pibicalfixturescustom_fieldjson","title":"<code>pibical/fixtures/custom_field.json</code>","text":"<p>Purpose: Defines custom fields added to User and Event doctypes</p> <p>User Fields:</p> <pre><code>{\n  \"fieldname\": \"caldav_url\",\n  \"fieldtype\": \"Data\",\n  \"label\": \"CalDAV URL\"\n},\n{\n  \"fieldname\": \"caldav_username\",\n  \"fieldtype\": \"Data\",\n  \"label\": \"CalDAV Username\"\n},\n{\n  \"fieldname\": \"caldav_token\",\n  \"fieldtype\": \"Password\",\n  \"label\": \"CalDAV Token\"\n}\n</code></pre> <p>Event Fields:</p> <pre><code>{\n  \"fieldname\": \"sync_with_caldav\",\n  \"fieldtype\": \"Check\",\n  \"label\": \"Sync with CalDAV\"\n},\n{\n  \"fieldname\": \"caldav_id_calendar\",\n  \"fieldtype\": \"Data\",\n  \"label\": \"CalDAV ID Calendar\"\n},\n{\n  \"fieldname\": \"caldav_id_url\",\n  \"fieldtype\": \"Data\",\n  \"label\": \"CalDAV ID URL\"\n},\n{\n  \"fieldname\": \"event_uid\",\n  \"fieldtype\": \"Data\",\n  \"label\": \"Event UID\",\n  \"unique\": false\n},\n{\n  \"fieldname\": \"event_stamp\",\n  \"fieldtype\": \"Datetime\",\n  \"label\": \"Event Stamp\"\n}\n</code></pre>"},{"location":"projects/pibical/guide/#api-reference","title":"\ud83d\udd0c API Reference","text":""},{"location":"projects/pibical/guide/#whitelisted-methods","title":"Whitelisted Methods","text":"<p>These methods can be called from client-side JavaScript or server-side Python.</p>"},{"location":"projects/pibical/guide/#get_calendarnuser","title":"<code>get_calendar(nuser)</code>","text":"<p>Purpose: Retrieve list of CalDAV calendars for a user</p> <p>Parameters: - <code>nuser</code> (string): User ID</p> <p>Returns: Array of calendar objects</p> <pre><code>[\n    {\n        \"name\": \"Personal\",\n        \"url\": \"https://cloud.example.com/remote.php/dav/calendars/user/personal/\"\n    },\n    {\n        \"name\": \"Work\",\n        \"url\": \"https://cloud.example.com/remote.php/dav/calendars/user/work/\"\n    }\n]\n</code></pre> <p>Usage (JavaScript):</p> <pre><code>frappe.call({\n    method: \"pibical.pibical.custom.get_calendar\",\n    args: {\n        nuser: frappe.session.user\n    },\n    callback: function(r) {\n        console.log(\"Calendars:\", r.message);\n        // Populate dropdown with calendars\n    }\n});\n</code></pre> <p>Usage (Python):</p> <pre><code>from pibical.pibical.custom import get_calendar\n\ncalendars = get_calendar(\"john.doe@example.com\")\nfor cal in calendars:\n    print(f\"{cal['name']}: {cal['url']}\")\n</code></pre>"},{"location":"projects/pibical/guide/#sync_caldav_event_by_userdoc-methodnone","title":"<code>sync_caldav_event_by_user(doc, method=None)</code>","text":"<p>Purpose: Sync single event to CalDAV (usually called by hook)</p> <p>Parameters: - <code>doc</code>: Event document object - <code>method</code>: Hook method name (optional)</p> <p>Returns: None (shows msgprint to user)</p> <p>Triggers: - Automatically on <code>Event.before_save</code> hook - Can be called manually</p> <p>Behavior: - Checks <code>doc.flags.ignore_caldav_sync</code> - skips if True - Creates new event if <code>doc.event_uid</code> is empty - Updates existing event if <code>doc.event_uid</code> exists - Falls back to create if update fails (event not found on CalDAV)</p> <p>Manual Usage (Python):</p> <pre><code>from pibical.pibical.custom import sync_caldav_event_by_user\n\nevent = frappe.get_doc(\"Event\", \"EV00001\")\nsync_caldav_event_by_user(event)\n</code></pre>"},{"location":"projects/pibical/guide/#remove_caldav_eventdoc-methodnone","title":"<code>remove_caldav_event(doc, method=None)</code>","text":"<p>Purpose: Delete event from CalDAV server</p> <p>Parameters: - <code>doc</code>: Event document object - <code>method</code>: Hook method name (optional)</p> <p>Returns: None (shows msgprint to user)</p> <p>Triggers: - Automatically on <code>Event.on_trash</code> hook - Called when \"Sync with CalDAV\" is disabled</p> <p>Behavior: - Tries 3 methods to find and delete event:   1. Direct URL lookup   2. UID search with date range   3. Date scan with UID matching</p> <p>Messages: - Success: \"Deleted Event in CalDav Calendar [name]\" - Not found: \"Event not found in CalDAV calendar\" - Permission error: \"Cannot delete due to insufficient permissions\"</p>"},{"location":"projects/pibical/guide/#send_event_invitationsevent_name-recipients","title":"<code>send_event_invitations(event_name, recipients)</code>","text":"<p>Purpose: Send .ics calendar invitations via email</p> <p>Parameters: - <code>event_name</code> (string): Event document name (e.g., \"EV00001\") - <code>recipients</code> (JSON array): List of recipients</p> <pre><code>[\n    {\n        \"send_invitation\": 1,\n        \"reference_doctype\": \"Contact\",\n        \"reference_docname\": \"CONT-0001\"\n    }\n]\n</code></pre> <p>Returns:</p> <pre><code>{\n    \"sent_count\": 3,\n    \"total_selected\": 3\n}\n</code></pre> <p>Usage (JavaScript):</p> <pre><code>frappe.call({\n    method: \"pibical.pibical.custom.send_event_invitations\",\n    args: {\n        event_name: \"EV00001\",\n        recipients: [\n            {\n                send_invitation: 1,\n                reference_doctype: \"Contact\",\n                reference_docname: \"CONT-0001\"\n            }\n        ]\n    },\n    callback: function(r) {\n        frappe.msgprint(`Sent ${r.message.sent_count} invitations`);\n    }\n});\n</code></pre> <p>Limitations: - Only works with Contact doctype - Contact must have email address - .ics file attached to email</p>"},{"location":"projects/pibical/guide/#background-jobs","title":"Background Jobs","text":""},{"location":"projects/pibical/guide/#sync_outside_caldav","title":"<code>sync_outside_caldav()</code>","text":"<p>Purpose: Sync events from CalDAV servers to Frappe (background job)</p> <p>Schedule: Every 3 minutes (configurable in <code>hooks.py</code>)</p> <p>Parameters: None</p> <p>Returns: None</p> <p>Process: 1. Gets all enabled users with CalDAV credentials 2. For each user, connects to CalDAV server 3. Fetches events from yesterday to +30 days 4. Compares with Frappe events by UID 5. Creates new events or updates modified ones 6. Sets <code>ignore_caldav_sync</code> flag to prevent loops</p> <p>Manual Trigger:</p> <pre><code>cd ~/frappe-bench\nbench --site your-site-name console\n&gt;&gt;&gt; from pibical.pibical.custom import sync_outside_caldav\n&gt;&gt;&gt; sync_outside_caldav()\n&gt;&gt;&gt; exit()\n</code></pre> <p>Performance: - Processes ~5-10 events per second - Uses event.data (no extra HTTP requests) - Isolated error handling (one bad event doesn't break sync)</p>"},{"location":"projects/pibical/guide/#performance","title":"\u26a1 Performance","text":""},{"location":"projects/pibical/guide/#optimization-improvements-v20","title":"Optimization Improvements (v2.0)","text":"Metric Before v2.0 After v2.0 Improvement Sync 10 events 8.5s 3.2s 62% faster Sync 50 events 45s 16s 64% faster Create event 2.1s 1.8s 14% faster Update event 3.8s 2.0s 47% faster HTTP requests/event 2-4 1 50-75% reduction DB queries/event 5-8 2-3 40-60% reduction"},{"location":"projects/pibical/guide/#performance-optimizations-implemented","title":"Performance Optimizations Implemented","text":"<ol> <li> <p>Use <code>event.data</code> Instead of HTTP GET:    <code>python    # Before: req = requests.get(event_url)  # Extra HTTP request!    # After:  event_data = url_event.data    # Direct access</code> Impact: 1 fewer HTTP request per event</p> </li> <li> <p>Fetch Only Required Database Fields:    <code>python    # Before: fields = ['*']  # All fields    # After:  fields = ['name', 'event_stamp', 'event_uid']  # Only needed</code> Impact: 40-60% faster DB queries</p> </li> <li> <p>Smart Update Mechanism:    <code>python    # Before: Delete event + Create new (2 operations)    # After:  c.save_event(ical, no_create=True)  # 1 operation</code> Impact: 50% fewer CalDAV operations</p> </li> <li> <p>Isolated Error Handling:    <code>python    # One bad event doesn't stop entire sync    for event in events:        try:            process_event(event)        except:            continue  # Skip this event, process others</code> Impact: Better reliability, no cascading failures</p> </li> </ol>"},{"location":"projects/pibical/guide/#performance-tuning","title":"Performance Tuning","text":""},{"location":"projects/pibical/guide/#for-small-calendars-100-events","title":"For Small Calendars (&lt;100 events)","text":"<pre><code># Increase sync window\nsel_events = c.date_search(\n    datetime.now().date() - timedelta(days=7),\n    datetime.now().date() + timedelta(days=60)\n)\n</code></pre>"},{"location":"projects/pibical/guide/#for-large-calendars-500-events","title":"For Large Calendars (&gt;500 events)","text":"<pre><code># Reduce sync window\nsel_events = c.date_search(\n    datetime.now().date(),  # Today only\n    datetime.now().date() + timedelta(days=14)\n)\n\n# Reduce sync frequency to 5 minutes\nscheduler_events = {\n  \"cron\": {\n    \"*/5 * * * *\": [...]\n  }\n}\n</code></pre>"},{"location":"projects/pibical/guide/#for-high-frequency-updates","title":"For High-Frequency Updates","text":"<pre><code># Increase sync frequency to 1 minute\nscheduler_events = {\n  \"cron\": {\n    \"*/1 * * * *\": [...]\n  }\n}\n</code></pre> <p>Warning: More frequent sync = higher server load</p>"},{"location":"projects/pibical/guide/#monitoring-performance","title":"Monitoring Performance","text":"<pre><code># Time a sync operation\nbench --site your-site-name console\n&gt;&gt;&gt; import time\n&gt;&gt;&gt; from pibical.pibical.custom import sync_outside_caldav\n&gt;&gt;&gt; start = time.time()\n&gt;&gt;&gt; sync_outside_caldav()\n&gt;&gt;&gt; duration = time.time() - start\n&gt;&gt;&gt; print(f\"Sync took {duration:.2f} seconds\")\n</code></pre> <p>Expected: &lt; 1 second per 5 events</p>"},{"location":"projects/pibical/guide/#troubleshooting","title":"\ud83d\udc1b Troubleshooting","text":""},{"location":"projects/pibical/guide/#common-issues","title":"Common Issues","text":""},{"location":"projects/pibical/guide/#unable-to-connect-to-caldav-server","title":"\"Unable to connect to CalDAV server\"","text":"<p>Causes: - Incorrect CalDAV URL - Wrong username/password - SSL/TLS issues - Network connectivity</p> <p>Solutions: 1. Verify CalDAV URL format:    <code>\u2705 https://cloud.example.com/remote.php/dav/principals/    \u274c https://cloud.example.com (missing path)</code></p> <ol> <li> <p>Test credentials:    <code>bash    curl -u username:password https://cloud.example.com/remote.php/dav/principals/username/</code></p> </li> <li> <p>Check SSL certificate:    <code>bash    openssl s_client -connect cloud.example.com:443</code></p> </li> <li> <p>Ensure no wildcard certificates (not supported by caldav library)</p> </li> </ol>"},{"location":"projects/pibical/guide/#event-with-uid-already-exists","title":"\"Event with UID already exists\"","text":"<p>Status: Should not occur in v2.0+</p> <p>If it does:</p> <pre><code>1. Disable \"Sync with CalDAV\" checkbox\n2. Save event\n3. Re-enable \"Sync with CalDAV\"\n4. Save again\n</code></pre> <p>This clears the UID and forces a fresh sync.</p>"},{"location":"projects/pibical/guide/#events-not-syncing-from-caldav","title":"\"Events not syncing from CalDAV\"","text":"<p>Diagnosis:</p> <pre><code># 1. Check scheduler status\nbench --site your-site-name doctor\n\n# Should show:\n# \u2713 Scheduler Active: Yes\n\n# 2. Check recent sync jobs\nbench --site your-site-name console\n&gt;&gt;&gt; import frappe\n&gt;&gt;&gt; jobs = frappe.get_all(\"Scheduled Job Log\",\n...     filters={\"scheduled_job_type\": \"sync_outside_caldav\"},\n...     fields=[\"creation\", \"status\"],\n...     order_by=\"creation desc\",\n...     limit=5)\n&gt;&gt;&gt; for j in jobs:\n...     print(f\"{j.creation}: {j.status}\")\n</code></pre> <p>Solutions: 1. Enable scheduler: <code>bench --site your-site-name enable-scheduler</code> 2. Restart bench: <code>bench restart</code> 3. Check Error Log for \"PibiCal\" entries</p>"},{"location":"projects/pibical/guide/#timezone-issues","title":"\"Timezone issues\"","text":"<p>Problem: Events showing wrong times</p> <p>Solution: 1. Set User timezone: User \u2192 Settings \u2192 Time Zone 2. Verify timezone:    ```python    bench --site your-site-name console</p> <p>import frappe user = frappe.get_doc(\"User\", \"your.email@example.com\") print(f\"User timezone: {user.time_zone}\")    ```</p> <ol> <li>All events stored in UTC on CalDAV, converted to user's local timezone in Frappe</li> </ol>"},{"location":"projects/pibical/guide/#consistencyerror-object-does-not-exist","title":"\"ConsistencyError: object does not exist\"","text":"<p>Status: Fixed in v2.0</p> <p>What it was: Event had UID (marked as \"existing\") but never actually synced to CalDAV</p> <p>Solution in v2.0: Automatically detects this and creates the event</p>"},{"location":"projects/pibical/guide/#duplicate-events","title":"\"Duplicate events\"","text":"<p>Causes: - UID mismatch between systems - Race condition during sync</p> <p>Prevention: - System checks UID + subject + time before creating - In-memory tracking prevents duplicates within same sync</p> <p>Fix duplicates:</p> <pre><code>bench --site your-site-name console\n&gt;&gt;&gt; import frappe\n&gt;&gt;&gt; # Find duplicates\n&gt;&gt;&gt; events = frappe.get_all(\"Event\",\n...     fields=[\"name\", \"subject\", \"starts_on\"],\n...     order_by=\"subject, starts_on\")\n&gt;&gt;&gt; # Manually delete duplicates in UI\n</code></pre>"},{"location":"projects/pibical/guide/#debug-mode","title":"Debug Mode","text":""},{"location":"projects/pibical/guide/#enable-detailed-logging","title":"Enable Detailed Logging","text":"<p>Edit <code>sites/your-site-name/site_config.json</code>:</p> <pre><code>{\n    \"developer_mode\": 1,\n    \"logging\": 2\n}\n</code></pre> <p>Restart: <code>bench restart</code></p>"},{"location":"projects/pibical/guide/#check-logs","title":"Check Logs","text":"<p>Error Log (Frappe UI): - Navigate to: Error Log doctype - Filter: <code>error LIKE '%PibiCal%'</code> - Sort: Creation desc</p> <p>Worker Log (Terminal):</p> <pre><code>tail -f ~/frappe-bench/logs/worker.log | grep -i pibical\n</code></pre> <p>Web Log (Terminal):</p> <pre><code>tail -f ~/frappe-bench/logs/web.log | grep -i caldav\n</code></pre>"},{"location":"projects/pibical/guide/#error-log-categories","title":"Error Log Categories","text":"Category Severity Meaning <code>PibiCal Sync Error</code> High Main sync operation failed <code>PibiCal Update Fallback</code> Info Event not found, creating instead (normal) <code>PibiCal Sync Parse Error</code> Medium Event data couldn't be parsed <code>PibiCal Sync Fetch Error</code> Medium Couldn't fetch event data from CalDAV <code>PibiCal Duplicate</code> Info Duplicate detected and skipped (normal) <code>CalDAV Connection Error</code> High Server unreachable"},{"location":"projects/pibical/guide/#getting-help","title":"Getting Help","text":"<ol> <li>Check Error Log first for recent errors</li> <li>Search GitHub Issues: https://github.com/pibico/pibical/issues</li> <li>Create Issue with:</li> <li>Frappe version</li> <li>PibiCal version/branch</li> <li>Error log entries</li> <li>Steps to reproduce</li> <li>Email Support: pibico.sl@gmail.com</li> </ol>"},{"location":"projects/pibical/guide/#development","title":"\ud83d\udee0\ufe0f Development","text":""},{"location":"projects/pibical/guide/#development-setup","title":"Development Setup","text":"<pre><code># Clone repository\ncd ~/frappe-bench/apps\ngit clone https://github.com/pibico/pibical.git\ncd pibical\n\n# Install in development mode\nbench --site your-site-name install-app pibical\n\n# Enable developer mode\n# Edit sites/your-site-name/site_config.json:\n{\n    \"developer_mode\": 1\n}\n\n# Restart\nbench restart\n</code></pre>"},{"location":"projects/pibical/guide/#code-style","title":"Code Style","text":"<ul> <li>Python: Follow PEP 8</li> <li>Indentation: 2 spaces (Frappe convention)</li> <li>Docstrings: Google style</li> <li>Comments: Explain \"why\", not \"what\"</li> </ul>"},{"location":"projects/pibical/guide/#testing","title":"Testing","text":"<p>No automated tests exist - testing is manual through Frappe UI and console.</p> <p>Test Checklist: - [ ] Create event in Frappe \u2192 Check NextCloud - [ ] Update event in Frappe \u2192 Check NextCloud - [ ] Create event in NextCloud \u2192 Check Frappe - [ ] Update event in NextCloud \u2192 Check Frappe - [ ] Delete event in Frappe \u2192 Check NextCloud - [ ] All-day events - [ ] Recurring events - [ ] Timezone conversion - [ ] Multiple calendars</p>"},{"location":"projects/pibical/guide/#debugging","title":"Debugging","text":"<p>Console Debugging:</p> <pre><code>bench --site your-site-name console\n&gt;&gt;&gt; from pibical.pibical.custom import sync_caldav_event_by_user\n&gt;&gt;&gt; import frappe\n&gt;&gt;&gt; frappe.set_user(\"Administrator\")\n&gt;&gt;&gt; event = frappe.get_doc(\"Event\", \"EV00001\")\n&gt;&gt;&gt; sync_caldav_event_by_user(event)\n</code></pre> <p>Add Debug Prints:</p> <pre><code># In custom.py\nimport sys\nprint(f\"DEBUG: Event UID = {doc.event_uid}\", file=sys.stderr)\n</code></pre> <p>Check stdout/stderr:</p> <pre><code>tail -f ~/frappe-bench/logs/worker.log\n</code></pre>"},{"location":"projects/pibical/guide/#adding-features","title":"Adding Features","text":""},{"location":"projects/pibical/guide/#to-add-new-synced-field","title":"To Add New Synced Field","text":"<ol> <li>Add field to Event doctype (via fixture or migration)</li> <li> <p>Update <code>sync_caldav_event_by_user()</code>:    <code>python    # Add to iCalendar event    if doc.my_new_field:        event.add('x-custom-field', doc.my_new_field)</code></p> </li> <li> <p>Update <code>prepare_fp_event()</code>:    <code>python    # Parse from CalDAV event    if 'x-custom-field' in cal_event:        event.my_new_field = str(cal_event.decoded('x-custom-field'))</code></p> </li> <li> <p>Test both directions</p> </li> </ol>"},{"location":"projects/pibical/guide/#to-add-new-caldav-server-support","title":"To Add New CalDAV Server Support","text":"<ol> <li> <p>Test connection:    <code>python    import caldav    client = caldav.DAVClient(url, username, password)    principal = client.principal()    calendars = principal.calendars()</code></p> </li> <li> <p>If compatible, should work out of the box</p> </li> <li>If not, may need server-specific handling</li> </ol>"},{"location":"projects/pibical/guide/#contributing","title":"Contributing","text":"<ol> <li>Fork the repository</li> <li>Create feature branch: <code>git checkout -b feature/amazing-feature</code></li> <li>Make changes and test thoroughly</li> <li>Commit: <code>git commit -m 'Add amazing feature'</code></li> <li>Push: <code>git push origin feature/amazing-feature</code></li> <li>Create Pull Request on GitHub</li> </ol> <p>PR Requirements: - Clear description of changes - Test results (screenshots/logs) - No breaking changes (or clearly documented) - Follows code style</p>"},{"location":"projects/pibical/guide/#recent-updates-v20","title":"\ud83c\udd95 Recent Updates (v2.0)","text":""},{"location":"projects/pibical/guide/#critical-fixes-december-2025","title":"Critical Fixes (December 2025)","text":""},{"location":"projects/pibical/guide/#1-infinite-sync-loop","title":"1. \u2705 Infinite Sync Loop","text":"<p>Problem: Events synced from CalDAV triggered <code>before_save</code> hook, syncing back to CalDAV (infinite loop)</p> <p>Solution: Document flags prevent hook during sync</p> <pre><code># Set flag when syncing FROM CalDAV\nevent.flags.ignore_caldav_sync = True\nevent.save()  # Hook checks flag and skips\n</code></pre> <p>Impact: 100% of loop incidents eliminated</p>"},{"location":"projects/pibical/guide/#2-uid-already-exists-error","title":"2. \u2705 \"UID Already Exists\" Error","text":"<p>Problem: Event updates failed with 400 Bad Request</p> <p>Solution: Use CalDAV's built-in update mechanism</p> <pre><code># Smart update\nc.save_event(ical_data, no_create=True, no_overwrite=False)\n</code></pre> <p>Impact: Update operations 47% faster, no more errors</p>"},{"location":"projects/pibical/guide/#3-consistencyerror","title":"3. \u2705 ConsistencyError","text":"<p>Problem: Events with UID but never synced to CalDAV</p> <p>Solution: Detect and handle gracefully</p> <pre><code>except Exception as e:\n    if \"does not exist\" in str(e) or \"ConsistencyError\" in str(e):\n        c.save_event(ical_data)  # Just create it\n</code></pre> <p>Impact: Seamless handling of edge case</p>"},{"location":"projects/pibical/guide/#4-performance-optimizations","title":"4. \u2705 Performance Optimizations","text":"<p>Changes: - Use <code>event.data</code> instead of HTTP GET (-1 request/event) - Fetch only required DB fields (-40-60% query time) - Isolated error handling (no cascading failures)</p> <p>Impact: - 64% faster sync operations - 50-75% fewer HTTP requests - 40-60% fewer DB queries</p>"},{"location":"projects/pibical/guide/#upgrade-from-v1x-to-v20","title":"Upgrade from v1.x to v2.0","text":"<pre><code># 1. Backup\nbench --site your-site-name backup\n\n# 2. Pull latest code\ncd ~/frappe-bench/apps/pibical\ngit pull origin develop\n\n# 3. Restart\ncd ~/frappe-bench\nbench restart\nbench clear-cache\n\n# 4. Test\n# Create/update events in both directions\n</code></pre> <p>Breaking Changes: None Data Migration: Not required</p>"},{"location":"projects/pibical/guide/#license","title":"\ud83d\udcc4 License","text":"<p>MIT License - see license.txt for details</p> <p>Copyright (c) 2020-2025 PibiCo</p>"},{"location":"projects/pibical/guide/#support","title":"\ud83d\udcde Support","text":""},{"location":"projects/pibical/guide/#resources","title":"Resources","text":"<ul> <li>Documentation: This README + CLAUDE.md</li> <li>GitHub Issues: https://github.com/pibico/pibical/issues</li> <li>GitHub Discussions: https://github.com/pibico/pibical/discussions</li> <li>Email: pibico.sl@gmail.com</li> </ul>"},{"location":"projects/pibical/guide/#reporting-issues","title":"Reporting Issues","text":"<p>When reporting issues, include:</p> <ol> <li>Environment:</li> <li>Frappe version: <code>bench version</code></li> <li>PibiCal branch: <code>git branch</code></li> <li> <p>CalDAV server (NextCloud/ownCloud version)</p> </li> <li> <p>Error Details:</p> </li> <li>Error Log entries (copy from Error Log doctype)</li> <li>Steps to reproduce</li> <li> <p>Expected vs actual behavior</p> </li> <li> <p>Logs (if applicable):    <code>bash    tail -100 ~/frappe-bench/logs/worker.log    tail -100 ~/frappe-bench/logs/web.log</code></p> </li> </ol>"},{"location":"projects/pibical/guide/#faq","title":"FAQ","text":"<p>Q: Can I sync private events? A: No, only \"Public\" events are synced for privacy/security.</p> <p>Q: Why 3-minute sync interval? A: Balance between real-time and server load. Configurable in <code>hooks.py</code>.</p> <p>Q: Do attachments sync?</p>"},{"location":"projects/pibicut/","title":"PibiCut","text":"<p>Welcome to the PibiCut documentation.</p>"},{"location":"projects/pibicut/#contents","title":"Contents","text":"<ul> <li>Project Guide</li> </ul>"},{"location":"projects/pibicut/guide/","title":"PibiCut Guide","text":"<p>PibiCut is a very Simple Frappe App to produce Shorten URLs on a Frappe Server and at the same time a QR Code to the short URL.</p>"},{"location":"projects/pibicut/guide/#requirements","title":"Requirements","text":"<p>Requires a Frappe server instance (refer to https://github.com/frappe/frappe), and has dependencies on QR Code (refer to https://github.com/lincolnloop/python-qrcode).</p>"},{"location":"projects/pibicut/guide/#compatibility","title":"Compatibility","text":"<p>PibiCut has been tested on Frappe/ERPNext version-12, version-13 and version-14 as well.</p>"},{"location":"projects/pibicut/guide/#installation","title":"Installation","text":"<p>From the frappe-bench folder, execute</p> <pre><code>$ bench get-app pibicut https://github.com/pibico/pibicut.git\n$ bench install-app pibicut\n</code></pre> <p>If you are using a multi-tenant environment, use the following command</p> <pre><code>$ bench --site site_name install-app pibicut\n</code></pre>"},{"location":"projects/pibicut/guide/#update","title":"Update","text":"<p>Run updates with</p> <pre><code>$ bench update\n</code></pre> <p>In case you update from the sources and observe errors, make sure to update dependencies with</p> <pre><code>$ bench update --requirements\n</code></pre>"},{"location":"projects/pibicut/guide/#features","title":"Features","text":"<p>Once installed, a new doctype 'Shortener' is generated. On searching the 'Shortener' Doctype you'll enter into the list of created shorten urls. You can create a new one, just click on New and enter the destination long URL. If you want, you can also insert a centered picture on the QR Code (the image must be in PNG format and white background, not transparent).</p> <p>As a result of saving the 'Shortener' Doctype, you will have a shorten url in the way http or https://site_name/MnOpQ. If you browse to this short url you will be redirected to the long url, the same is produced if you read the generated QR Code. Just try reading the QR Code in the following picture.</p> <p></p>"},{"location":"projects/pibicut/guide/#license","title":"License","text":"<p>MIT# PibiCut</p>"},{"location":"projects/pibicut/guide/#references","title":"References","text":"<ul> <li>GitHub Repository</li> </ul>"}]}